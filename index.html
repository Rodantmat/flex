<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,user-scalable=yes" />
<title>Amazon Flex - Horas</title>
<style>
  :root {
    --accent: #1a3d7c;
    --bg: #f8f9fa;
    --muted: #666;
  }

  html, body {
    width: 100%;
    height: 100%;
    margin: 0;
    padding: 0;
    background: var(--bg);
    color: #111;
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    overflow-x: hidden; /* prevent double scroll */
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }

  /* ðŸ”¹ Center main wrapper safely (no overflow block) */
  body {
    display: block; /* instead of flex, fixes iOS scroll lock */
    text-align: center;
  }

  /* ðŸ”¹ Wrapper for everything */
  #page-wrapper {
    width: 100%;
    max-width: 950px;
    margin: 0 auto;
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  h1 {
    color: var(--accent);
    margin: 10px 0;
    font-size: clamp(16px, 2.2vw, 18px);
  }

  h2 {
    color: var(--accent);
    margin: 16px 0 8px;
    font-size: clamp(14px, 2vw, 15px);
  }

  .instructions {
    max-width: 820px;
    margin: 0 auto 10px;
    color: var(--muted);
    font-size: clamp(12px, 1.8vw, 13px);
    line-height: 1.35;
    text-align: center;
    white-space: pre-line;
  }

  /* ðŸ”¹ Center area can scroll horizontally */
  .center {
    display: flex;
    justify-content: center;
    overflow-x: auto !important;
    overflow-y: visible;
    width: 100%;
    -webkit-overflow-scrolling: touch;
    scroll-behavior: smooth;
  }

  table {
    border-collapse: collapse;
    margin: 8px auto;
    font-size: clamp(12px, 1.8vw, 13px);
    max-width: 100%;
    table-layout: fixed;
  }

  th, td {
    padding: 4px 6px;
    text-align: center;
    white-space: nowrap;
  }

  th {
    color: var(--accent);
    font-weight: 600;
  }

  /* ðŸ”¹ Input â€” numeric keyboard with decimals only */
  input[type=number] {
    width: 44px;
    padding: 4px;
    border: 1px solid #cfcfcf;
    border-radius: 4px;
    text-align: center;
    font-size: inherit;
    min-width: 36px;
    -moz-appearance: textfield;
  }

  input[type=number]::-webkit-inner-spin-button,
  input[type=number]::-webkit-outer-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }

  input[type=number][inputmode="decimal"] {
    appearance: none;
  }

  /* total cells */
  .total {
    font-weight: 700;
    padding: 2px 6px;
    border-radius: 6px;
    display: inline-block;
    min-width: 30px;
  }

  .green { background: #dff3df; }
  .red { background: #ffe2e2; }

  .controls {
    display: flex;
    gap: 8px;
    justify-content: center;
    margin-top: 10px;
  }

  button {
    background: var(--accent);
    color: white;
    border: none;
    padding: 8px 12px;
    border-radius: 6px;
    font-size: clamp(12px, 2vw, 14px);
    cursor: pointer;
  }

  button.secondary {
    background: #eee;
    color: #222;
  }

  .small {
    font-size: 12px;
    padding: 6px 10px;
    border-radius: 6px;
  }

  .hidden { display: none; }

  .note {
    font-size: 12px;
    color: var(--muted);
    text-align: center;
    margin-top: 6px;
  }

  #alertBox {
    display: none;
    background: #ffdddd;
    color: #900;
    border: 1px solid #a00;
    border-radius: 6px;
    text-align: center;
    max-width: 820px;
    margin: 10px auto;
    padding: 10px;
    white-space: pre-line;
  }

  /* ðŸ”¹ Responsive fine-tuning */
  @media (max-width: 900px) {
    table { font-size: clamp(11px, 1.8vw, 12.5px); }
    input[type=number] { width: 40px; }
  }

  @media (max-width: 720px) {
    table { font-size: 12px; }
    input[type=number] { width: 38px; }
  }

  @media (max-width: 480px) {
    table { font-size: 11.5px; }
    th, td { padding: 3px 5px; }
    input[type=number] { width: 36px; }
    h1, h2 { margin: 8px 0; }
  }

  @media (orientation: landscape) and (max-height: 500px) {
    table { font-size: 12px; }
    .instructions { font-size: 11px; }
  }
</style>

</head>
<body>
<div id="page-wrapper">
  <h1 id="title">Amazon Flex â€” Horas</h1>
  <div id="alertBox"></div>

  <div id="screen-completed">
    <h2 id="completed-title"></h2>
    <div class="center"><div id="completed-table-container"></div></div>
    <div id="completed-instructions" class="instructions"></div>
    <div class="controls"><button id="continue-btn">Continue</button></div>
  </div>

  <div id="screen-scheduled" class="hidden">
    <h2 id="scheduled-title"></h2>
    <div class="center"><div id="scheduled-table-container"></div></div>
    <div id="scheduled-instructions" class="instructions"></div>
    <div class="controls"><button class="secondary small" id="back-btn">Back</button></div>
  </div>
</div>

<script>
// ---------------- Localization ----------------
const LOCALES={en:{title:"Amazon Flex â€” Hours",completedTitle:"Completed Shifts",scheduledTitle:"Scheduled Shifts",
completedInstructions:`Add your shifts worked in the last 6 days.\nYou can find them under the "Earnings" tab.\nIf you worked more than two shifts in a day, add them together and put the total into the 1st or 2nd shift.\nThe hours will be saved and rolled through the days as you return, so you donâ€™t have to retype them each time you open it in the same browser.`,
scheduledInstructions:`Now add scheduled shifts for today and the next 7 days.\nYou can find them under "Calendar" or "Schedule".\nIf you have more than two shifts in a day, sum them and add the total to 1st or 2nd shift.\nThe "Avail." row shows how many hours you have available to reserve on each day.\nThe hours will be saved and rolled through the days as you return, so you donâ€™t have to retype them each time you open it in the same browser.`,
columns:{day:"Day",t1:"1st Shift",t2:"2nd Shift",total:"Total",avail:"Avail."},continue:"Continue",back:"Back"},
es:{title:"Amazon Flex â€” Horas",completedTitle:"Turnos Completados",scheduledTitle:"Turnos Programados",
completedInstructions:`Agregue sus turnos trabajados en los Ãºltimos 6 dÃ­as.\nPuedes encontrarlos en la pestaÃ±a "Ganancias".\nSi trabajaste mÃ¡s de 2 turnos por dÃ­a, sÃºmalos y agrÃ©guelos al 1Âº o 2Âº turno.\nLas horas se guardarÃ¡n y se irÃ¡n acumulando a lo largo de los dÃ­as cuando regreses, para que no tengas que volver a escribirlas cada vez que abras la aplicaciÃ³n en el mismo navegador.`,
scheduledInstructions:`Ahora agregue los turnos programados para hoy y los prÃ³ximos 7 dÃ­as.\nPuedes encontrarlos en "Calendario" o "Horario".\nSi tienes programado mÃ¡s de 2 turnos por dÃ­a, sÃºmalos y agrÃ©guelos al 1Âº o 2Âº turno.\nLa lÃ­nea "Disp." presenta la cantidad de horas que tienes disponible para reservar turnos en cada dÃ­a.\nLas horas se guardarÃ¡n y se irÃ¡n acumulando a lo largo de los dÃ­as cuando regreses, para que no tengas que volver a escribirlas cada vez que abras la aplicaciÃ³n en el mismo navegador.`,
columns:{day:"DÃ­a",t1:"1Âº Turno",t2:"2Âº Turno",total:"Total",avail:"Disp."},continue:"Continuar",back:"Volver"}};
const userLang=navigator.language.startsWith("es")?"es":"en",L=LOCALES[userLang];
document.getElementById("title").textContent=L.title;
document.getElementById("completed-title").textContent=L.completedTitle;
document.getElementById("scheduled-title").textContent=L.scheduledTitle;
document.getElementById("completed-instructions").textContent=L.completedInstructions;
document.getElementById("scheduled-instructions").textContent=L.scheduledInstructions;
document.getElementById("continue-btn").textContent=L.continue;
document.getElementById("back-btn").textContent=L.back;

// ---------------- Helpers ----------------
const MONTHS_EN=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
const MONTHS_ES=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"];
const DAYS_EN=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
const DAYS_ES=["Dom","Lun","Mar","Mi","Jue","Vie","SÃ¡b"];
function baseDate(){const t=new Date();return new Date(t.getFullYear(),t.getMonth(),t.getDate());}
function shortMonth(d){return userLang==="es"?MONTHS_ES[d.getMonth()]:MONTHS_EN[d.getMonth()];}
function shortDay(d){return userLang==="es"?DAYS_ES[d.getDay()]:DAYS_EN[d.getDay()];}
function mmdd(d){return (d.getMonth()+1).toString().padStart(2,"0")+"/"+d.getDate().toString().padStart(2,"0");}

// ---------------- Build Tables ----------------
function makeDates(offsetStart,offsetEnd){const b=baseDate(),out=[];for(let i=offsetStart;i<=offsetEnd;i++){const d=new Date(b);d.setDate(b.getDate()+i);out.push(d);}return out;}
const completedDates=makeDates(-6,-1);
const scheduledDates=makeDates(0,7);
function buildTable(dates,id,start,withAvail){
 const c=document.getElementById(id);c.innerHTML="";
 const t=document.createElement("table");
 const h=document.createElement("tr");h.innerHTML="<th></th>"+dates.map(d=>`<th>${shortMonth(d)} ${d.getDate()}</th>`).join("");t.appendChild(h);
 const drow=document.createElement("tr");drow.innerHTML=`<th>${L.columns.day}</th>`+dates.map(d=>`<td>${shortDay(d)}</td>`).join("");t.appendChild(drow);
 const t1=document.createElement("tr");t1.innerHTML=`<th>${L.columns.t1}</th>`;
 const t2=document.createElement("tr");t2.innerHTML=`<th>${L.columns.t2}</th>`;
 let tab=1;
 dates.forEach((_,i)=>{const idx=start+i;
      t1.innerHTML+=`<td><input type="number" inputmode="decimal" pattern="[0-9]*[.,]?[0-9]*" class="t1" data-index="${idx}" min="0" max="5" step="0.5" tabindex="${tab++}"></td>`;
   t2.innerHTML+=`<td><input type="number" inputmode="decimal" pattern="[0-9]*[.,]?[0-9]*" class="t2" data-index="${idx}" min="0" max="5" step="0.5" tabindex="${tab++}"></td>`;
});
 t.appendChild(t1);t.appendChild(t2);
 const trT=document.createElement("tr");trT.innerHTML=`<th>${L.columns.total}</th>`+dates.map((_,i)=>`<td><span id="total-${start+i}" class="total">0.0</span></td>`).join("");t.appendChild(trT);
 if(withAvail){const trA=document.createElement("tr");trA.innerHTML=`<th>${L.columns.avail}</th>`+dates.map((_,i)=>`<td><span id="avail-${start+i}">8.0</span></td>`).join("");t.appendChild(trA);}
 c.appendChild(t);
}
buildTable(completedDates,"completed-table-container",0,false);
buildTable(scheduledDates,"scheduled-table-container",6,true);

// ---------------- Alerts ----------------
function showAlert(msg){
 const box=document.getElementById("alertBox");
 box.innerHTML=msg;
 box.style.display="block";
 clearTimeout(box._t);
 box._t=setTimeout(()=>box.style.display="none",10000);
}
const MSG={en:{err8:d=>`Something is wrong, you have entered more than 8 hours for the day ${d}.\nPlease review your hours for that period.`,
err40:(s,e)=>`Something is wrong, you have entered more than 40 for the period from ${s} to ${e}.\nPlease review your hours for that period.`},
es:{err8:d=>`Algo estÃ¡ mal, ha ingresado mÃ¡s de 8 horas para el dÃ­a ${d}.\nPor favor revise sus horas para ese perÃ­odo.`,
err40:(s,e)=>`Algo estÃ¡ mal, ha ingresado mÃ¡s de 40 horas para el perÃ­odo del ${s} al ${e}.\nPor favor revise sus horas para ese perÃ­odo.`}}[userLang];

// ---------------- Core logic ----------------
function readTotals(){const t=new Array(14).fill(0);document.querySelectorAll("input.t1,input.t2").forEach(inp=>{const idx=+inp.dataset.index;const v=parseFloat(inp.value)||0;t[idx]+=v;});return t;}
function computeAndRender(){
 const t=readTotals();
 for(let i=0;i<14;i++){const el=document.getElementById("total-"+i);if(el)el.textContent=(t[i]||0).toFixed(1);}
 for(let i=6;i<=13;i++){
   let minA=Infinity;
   for(let s=0;s<=7;s++){const e=s+6;if(i>=s&&i<=e){let sum=0;for(let k=s;k<=e;k++)sum+=t[k];minA=Math.min(minA,40-sum);}}
   if(minA===Infinity)minA=8;
   const avail=Math.max(0,Math.min(8-(t[i]||0),minA));
   const aE=document.getElementById("avail-"+i);if(aE)aE.textContent=avail.toFixed(1);
   const tE=document.getElementById("total-"+i);
   if(tE){tE.classList.remove("green","red");if(avail<=0)tE.classList.add("red");else tE.classList.add("green");}
 }
}
document.addEventListener("input",e=>{
 if(!e.target.classList.contains("t1")&&!e.target.classList.contains("t2"))return;
 const i=e.target;const idx=+i.dataset.index;
 const t1=document.querySelector(`input.t1[data-index='${idx}']`);
 const t2=document.querySelector(`input.t2[data-index='${idx}']`);
 const v1=parseFloat(t1.value)||0;const v2=parseFloat(t2.value)||0;
 if(v1+v2>8){showAlert(MSG.err8(mmdd(makeDates(-6,7)[idx])));i.value="";return;}
 const totals=readTotals();totals[idx]=v1+v2;
 for(let s=0;s<=7;s++){const e=s+6;let sum=0;for(let k=s;k<=e;k++)sum+=totals[k];if(sum>40){showAlert(MSG.err40(mmdd(makeDates(-6,7)[s]),mmdd(makeDates(-6,7)[e])));i.value="";return;}}
 computeAndRender();saveData();
});

// ---------------- Auto-save & Two-way Auto-roll ----------------
const SAVE_KEY="aflex_hours_v2";
function saveData(){
 const data={date:baseDate().toISOString().slice(0,10)};
 document.querySelectorAll("input.t1,input.t2").forEach(inp=>{
   data["i"+inp.dataset.index+"_"+(inp.classList.contains("t1")?"t1":"t2")]=inp.value||"";
 });
 localStorage.setItem(SAVE_KEY,JSON.stringify(data));
}
function loadData(){
 try{
   const raw=localStorage.getItem(SAVE_KEY);
   if(!raw)return;
   const data=JSON.parse(raw);
   const last=new Date(data.date);
   const today=baseDate();
   const diff=Math.round((today-last)/(1000*60*60*24)); // can be + or -
   if(diff!==0){
     const newData={date:today.toISOString().slice(0,10)};
     for(let i=0;i<14;i++){
       for(const t of["t1","t2"]){
         const src=i+diff;
         newData["i"+i+"_"+t]=(src>=0&&src<14)?data["i"+src+"_"+t]||"":"";
       }
     }
     localStorage.setItem(SAVE_KEY,JSON.stringify(newData));
     Object.assign(data,newData);
   }
   document.querySelectorAll("input.t1,input.t2").forEach(inp=>{
     const k="i"+inp.dataset.index+"_"+(inp.classList.contains("t1")?"t1":"t2");
     if(data[k]!==undefined)inp.value=data[k];
   });
   computeAndRender();
 }catch(e){}
}
loadData();

// ---------------- Navigation ----------------
const scC=document.getElementById("screen-completed"),scS=document.getElementById("screen-scheduled");
document.getElementById("continue-btn").onclick=()=>{scC.classList.add("hidden");scS.classList.remove("hidden");window.scrollTo(0,0);}
document.getElementById("back-btn").onclick=()=>{scS.classList.add("hidden");scC.classList.remove("hidden");window.scrollTo(0,0);}
</script>
</body>
</html>
